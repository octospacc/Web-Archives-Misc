{"version":3,"sources":["webpack:///./node_modules/file-saver/dist/FileSaver.min.js","webpack:///./src/pages/game/save.f7.html"],"names":["c","b","d","e","XMLHttpRequest","open","responseType","onload","a","response","onerror","console","error","send","status","dispatchEvent","MouseEvent","document","createEvent","initMouseEvent","window","f","self","global","saveAs","HTMLAnchorElement","prototype","g","h","i","URL","webkitURL","j","createElement","name","download","rel","href","origin","location","target","createObjectURL","setTimeout","revokeObjectURL","navigator","msSaveOrOpenBlob","autoBom","warn","test","type","Blob","title","body","innerText","HTMLElement","safari","userAgent","FileReader","onloadend","result","replace","readAsDataURL","k","l","module","exports","data","this","$route","context","methods","downloadSave","saveID","JSON","parse","localStorage","getItem","game","id","contents","base64ToArray","buffer","Uint8Array","blob","Date","getTime","$app","dialog","alert","uploadSave","getElementById","click","fileUploaded","evt","_this","confirm","log","file","files","fileExtension","substring","lastIndexOf","toLowerCase","isDelta","indexOf","length","system","reader","json","atob","setItem","stringify","toast","create","text","closeTimeout","resetSave","storage","remove","render","boxart","encodeURI","expandSystem","styleScoped"],"mappings":"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","file":"js/18.app.js","sourcesContent":["(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(b,c,d){var e=new XMLHttpRequest;e.open(\"GET\",b),e.responseType=\"blob\",e.onload=function(){a(e.response,c,d)},e.onerror=function(){console.error(\"could not download file\")},e.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(a,b,d,e){if(e=e||open(\"\",\"_blank\"),e&&(e.document.title=e.document.body.innerText=\"downloading...\"),\"string\"==typeof a)return c(a,b,d);var g=\"application/octet-stream\"===a.type,h=/constructor/i.test(f.HTMLElement)||f.safari,i=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((i||g&&h)&&\"object\"==typeof FileReader){var j=new FileReader;j.onloadend=function(){var a=j.result;a=i?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),e?e.location.href=a:location=a,e=null},j.readAsDataURL(a)}else{var k=f.URL||f.webkitURL,l=k.createObjectURL(a);e?e.location=l:location.href=l,e=null,setTimeout(function(){k.revokeObjectURL(l)},4E4)}});f.saveAs=a.saveAs=a,\"undefined\"!=typeof module&&(module.exports=a)});\n\n//# sourceMappingURL=FileSaver.min.js.map","import { saveAs } from 'file-saver';\nimport { base64ToArray } from '../../js/b64';\nexport default {\n  data() {\n    return this.$route.context;\n  },\n  methods: {\n    downloadSave() {\n      try {\n        const saveID = JSON.parse(localStorage.getItem(`SAVE_${ this.game.id }`));\n        const contents = base64ToArray(JSON.parse(localStorage.getItem(`SAVE_${ saveID }`)));\n        let buffer = new Uint8Array(contents);\n        const blob = new Blob([buffer], { type: 'application/octet-stream' });\n        saveAs(blob, `${ this.game.name } ${ new Date().getTime() }.sav`);\n      } catch (error) {\n        this.$app.dialog.alert('There is no save data for this game.');\n      }\n    },\n    uploadSave() {\n      document.getElementById('saveUpload').click();\n    },\n    fileUploaded(evt) {\n      var _this = this;\n      this.$app.dialog.confirm('Are you sure you want to load this save?', () => {\n        console.log(evt);\n        var files = evt.target.files;\n        var file = files[0];\n        var fileExtension = file.name.substring(file.name.lastIndexOf('.') + 1).toLowerCase();\n        var isDelta = file.name.indexOf('gamesave-') === 0 && file.name.indexOf('-gamesave') === file.name.length - 9;\n        console.log(fileExtension);\n        if (fileExtension === `eclipsesave_${ this.game.system.toLowerCase() }`) {\n          var reader = new FileReader();\n          reader.readAsDataURL(file);\n          reader.onload = () => {\n            var result = reader.result;\n            var json = JSON.parse(atob(result.replace('data:;base64,', '').replace('data:text/plain;charset=x-user-defined;base64,', '').replace('data:application/octet-stream;base64,', '').replace('ï\\xBB\\xBF', '')));\n            localStorage.setItem(`SAVE_${ JSON.parse(localStorage.getItem(`SAVE_${ _this.game.id }`)) }`, JSON.stringify(json));\n            this.$app.toast.create({\n              text: `Loaded legacy Eclipse save for \"${ _this.game.name }\".`,\n              closeTimeout: 2000\n            }).open();\n          };\n          reader.onerror = error => {\n            this.$app.toast.create({\n              text: `Could not load legacy Eclipse save file.`,\n              closeTimeout: 2000\n            }).open();\n            console.log('Error: ', error);\n          };\n        } else if (fileExtension === 'sav' || isDelta) {\n          var reader = new FileReader();\n          reader.readAsDataURL(file);\n          reader.onload = function () {\n            var result = reader.result;\n            var json = result.replace('data:;base64,', '').replace('data:text/plain;charset=x-user-defined;base64,', '').replace('data:application/octet-stream;base64,', '').replace('ï\\xBB\\xBF', '');\n            localStorage.setItem(`SAVE_${ JSON.parse(localStorage.getItem(`SAVE_${ _this.game.id }`)) }`, JSON.stringify(json));\n            _this.$app.toast.create({\n              text: isDelta ? `Loaded Delta save for \"${ _this.game.name }\".` : `Loaded battery save for \"${ _this.game.name }\".`,\n              closeTimeout: 2000\n            }).open();\n          };\n          reader.onerror = function (error) {\n            _this.$app.toast.create({\n              text: isDelta ? `Could not load Delta save file.` : `Could not load battery save file.`,\n              closeTimeout: 2000\n            }).open();\n            console.log('Error: ', error);\n          };\n        } else {\n          this.$app.dialog.alert(`Invalid file type. Please upload an \"eclipsesave_${ this.game.system.toLowerCase() }\" or .sav file.`);\n        }\n      });\n    },\n    resetSave() {\n      this.$app.dialog.confirm('Are you sure you want to reset your save? All progress will be lost.', () => {\n        this.$app.methods.storage.remove(`SAVE_${ JSON.parse(localStorage.getItem(`SAVE_${ this.game.id }`)) }`);\n      });\n    }\n  },\n  id: '4e01dc3f1d',\n  render() {\n    return `\n  <div class=\"popup\">\n    <div class=\"view\">\n      <div class=\"page\">\n        <div class=\"navbar\">\n          <div class=\"navbar-inner\">\n            <div class=\"left\">\n              <a class=\"link popup-close\">\n                <i class=\"icon f7-icons ios-only\">close</i>\n                <i class=\"icon material-icons md-only\">close</i>\n              </a>\n            </div>\n            <div class=\"title\">Save</div>\n          </div>\n        </div>\n        <div class=\"page-content\">\n          <div class=\"block\" style=\"text-align: center;\">\n            <img src=\"${ this.game.boxart.indexOf(' ') > -1 ? encodeURI(this.game.boxart) : this.game.boxart }\" style=\"border-radius: 5px; max-height: 256px; max-width: 256px\">\n            <h1>${ this.game.name }</h1>\n            <p>${ this.$app.methods.game.expandSystem(this.game.system) }</p>\n            <p>Below, you can easily download, upload, or remove your save data for this game.</p>\n          </div>\n          <div class=\"list\">\n            <ul>\n              <li>\n                <a class=\"item-link list-button\" @click=\"downloadSave\">Download</a>\n              </li>\n              <li>\n                <a class=\"item-link list-button\" @click=\"uploadSave\">Upload</a>\n              </li>\n            </ul>\n          </div>\n          <input id=\"saveUpload\" type=\"file\" style=\"display:none;\" @change=\"fileUploaded\">\n          <div class=\"list\">\n            <ul>\n              <li>\n                <a class=\"item-link list-button text-color-red\" @click=\"resetSave\">Reset</a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n`;\n  },\n  styleScoped: false\n};"],"sourceRoot":""}